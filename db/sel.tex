\section{Selection}

This analysis uses the full $3.0\invfb$ of data collected by the \lhcb
experiment~\cite{Alves:2008zz} in the years 2011 and 2012 at 7 and $8\tev$ respectively.
Since the properties of the \db are unknown, a variety of simulated samples of the decay \btokstrdb,
where \dbtomumu, were generated with a range of \mass{\db} and $\tau_\db$, a summary of these are
shown in \Table{tab:db:samples}.
Also used in this analysis, are simulated events of the decays \btokstrmumu and \btojpsikstr.

\begin{table}
  \caption[Samples of simulated \btokstrdb generated for the analysis]{
    Samples of simulated \btokstrdb generated with given mass and lifetime.
    A total of 1.5 million events are generated for each sample, but only 150 thousand for the
    samples with a \mass{\db} of 220 and $235\mev$.
  }
  \label{tab:db:samples}
  \begin{center}
    \begin{tabular}{rccccccccccc}\toprule
    %\begin{tabular*}{\textwidth}{r @{\extracolsep{\fill}} ccccccccccc}\toprule
      $\tau_\db$ (ps) & \multicolumn{10}{c}{\mass{\db} (MeV)} \\\midrule
      10 &&&&&&&&&2500 \\
      100 &214&220&235&250&500&800&1000&1500&2000&2500&4000 \\
      1000 &&&&250&&&&&2500 \\
      \bottomrule
    \end{tabular}
    %\end{tabular*}
  \end{center}
\end{table}

Reconstructed decays of \btokstrdb are required to fire the \lone triggers for muon, dimuon, or
hadronic candidates.
Subsequent trigger levels require that the decay has a topology consistent with a $B$-meson
decaying in to a multi-body final state which includes muons.
Only \TOS candidates are used in this analysis for two reasons: firstly, the ratio of trigger
efficiency for the \sm \btokstrmumu to that of (possibly displaced) \db mode enters
into the limits and, thus, must be precisely determined; and the use of \TIS events would
come with a substantial enhancement of the di-$b$-hadron backgrounds.
The few percent gain in signal efficiency obtained using \TIS is not worth the increase in these
backgrounds  di-$b$-hadron backgrounds.

Candidates for the decay \btokstrdb, where \dbtomumu are reconstructed allowing that the \db can
be displaced from the decay vertex of the \Bd.
Since the \db could be a long-lived particle, and travel beyond the acceptance of the \velo before
it decays, it is prudent to consider the use of \emph{downstream} tracks.
Track types are defined by which tracking subdetectors in which they are observed,
\Fig{fig:db:lldd} shows these various definitions.
For most \lhcb analyses, the only appropriate track to use are \emph{long} tracks, which have hits
in each tracking station; long tracks are used in the analyses described in \Chap{ch:hits} and
\Chap{ch:hhh}.
The problem with using downstream tracks is that they are not triggered efficiently in \hlttwo.
For example, a simulated \db with a mass of $250\mev$ and a lifetime of $100\ps$ has a
reconstruction and
stripping efficiency of \approx$0.9\pc$ if the muons are both long tracks, but the equivalent
number for downstream tracks is \approx$2.5\pc$; due to the boost of a light object from a decaying
\Bd.
However, the trigger efficiency for this sample is \approx$45\pc$ and $8\pc$ for long and
downstream candidates respectively.
There is therefore a factor two more long-track candidates for the $250\mev$ $100\ps$ sample; which
is a factor of a few hundred for more massive, or shorter lifetime, dark bosons.
For this reason, this analysis deals only with \db candidates formed from long-track muons.

\begin{figure}
  \begin{center}
    %\includegraphics[width=0.48\textwidth]{track}
    \includegraphics[scale=0.7]{track}
    \caption[Track definitions in the LHCb detector]
    {
      Schematic diagram of the \lhcb tracking system, showing the \velo, \ttracker, and tracking
      stations T1--3.
      Track types at \lhcb are defined by the regions through which they travel, as labelled in the
      diagram.
      Most tracks used in analyses are classified as long tracks, but for long-lived particles
      (such as the \KS) downstream tracks are often also used to increase statistics.
      This analysis focused on long tracks.
      %and tracking stations one, two, and three.
      %This analysis focuses on particles decaying into a pair of long tracks.
    }
    \label{fig:db:lldd}
  \end{center}
\end{figure}

%The selection
%Simulated samples are extremely important for this analysis,
%It is important to remove sources of background while leaving the invariant mass of the dimuon
%distribution smoothly varying, so that the assumption of local-linearity remains.
%In \Sec{sec:strategy} resonances are discussed, and those where $\Gamma<5\sigmam$ must be vetoed.
%For this analysis,


The offline selection criteria applied in the stripping are outlined in \Tab{tab:stripping}.
%The variable {\tt DOCA} is defined as the distance of closest approach between any two pairs of
%tracks in the candidate.
This table lists the variables {\tt ProbNNK} and {\tt ProbNNpi}, which are \MVA algorithms giving a
response $\in[0,1]$ quantifying how kaon or pion like a particle is, respectively.
The full decay chain \btokstrdb and \dbtomumu is reconstructed using a fit in which the \Bd mass is
constrained to its known value~\cite{PDG2014}.
All references to $m(\db)$, $m(\Kstar)$ or $\tau(\db)$ are to the values after this vertex fit
has been performed.

\begin{table}
  \caption[Stripping selection]
  {
    While the \Bd mass is constrained in the fit, the selection makes a cut on the unconstrained
    mass.
    %The variable {\tt DOCA} is defined as the distance of closest approach between any two pairs of
    %tracks in the candidate.
  }
  \label{tab:stripping}
  \begin{center}
    \begin{tabularcuts}
      \Bp
      & $\chisqvtx/\ndf$          & $<$ & 25   \\
      & \chisqip                  & $<$ & 50   \\ % BPVIPCHI2
      & $\tau$                    & $>$ & 0.2 & ps  \\
      & $m$                       & $\in$ & $[4800, 5800]$  & MeV \\
      & \pt                       & $>$ & 1000    & MeV   \\
      & $\cos\theta_\mathrm{dir}$     & $>$ & 0 \\
      \littlerule
      \db
      & $\chisqvtx/\ndf$          & $<$ & 10   \\ % VCHI2DOF
      & $\chisqfd$                & $<$ & 25   \\
      & \pt                       & $>$ & 250  & MeV \\
      & DOCA                & $<$ & 0.2 & mm \\
      & DOCA \chisq         & $<$ & 25  &    \\
      \littlerule
      Tracks
      & $\chisqtrk/\ndf$          & $<$ & 3    \\
      & $\min(\chisqip)$                  & $>$ & 9    \\ % MIPCHI2DV
      & $\mathcal{P}_\mathrm{gh}$ & $<$ & 0.3  \\
      \littlerule
      $\Kp$, $\pip$
      & \pt                       & $>$ & 250  & MeV \\
      & $p$                       & $>$ & 2000 & MeV \\
      & \chisqip                  & $>$ & 9 \\
      \Kp
      & {\tt ProbNNK}             & $>$ & 0.1  \\
      \pip
      & {\tt ProbNNpi}            & $>$ & 0.2  \\
      \mup
      & \pt                       & $>$ & 100  & MeV \\
      & {\tt PIDmu}               & $>$ & -5   \\
      & \ismuon                   & & True \\
      \bottomrule
    \end{tabularcuts}
  \end{center}
\end{table}


\subsection{Preselection}
After the stripping and triggering stages, a loose preselection is applied (see \Tab{tab:presel}).
The data sample is further purified using a multivariate algorithm, which is discussed in the
following subsection.
The preselection places cuts on topological quantities the combined efficiency of which is
\approx$90\%$ on all simulated samples.

Cuts are applied to the \Kstar and its daughters to remove candidates that are clearly
inconsistent with the decay  \decay{\Kstarz}{\kpi}.
Firstly, It is required that the invariant mass of the \decay{\Kstarz}{\kpi} candidate has a mass
within $100\mev$ of the known mass of the $K^*(892)^0$ meson, which has been measured to be
$(895.81\pm0.19)\mev$~\cite{PDG2014}.
\pid constraints are also applied to each \Kstar daughter: $\dllkpi(\Kp)>-5$, $\dllkpi(\pip)<25$;
and to ensure that the kaon candidate looks more like a kaon than the pion candidate a cut on the
difference in \glspl{DLL} is also applied: $\dllkpi(\Kp)-\dllkpi(\pip)>10$.

Another background from misidentified particles that is removed in the preselection is that of a
decaying \KS meson.
A \KS has a mass of $(497.61\pm0.02)\mev$~\cite{PDG2012}, a lifetime of
$(8.954\pm0.004)\e{-11}\sec$~\cite{PDG2012}, and decays
into two charged pions $(69.20 \pm0.05)\pc$ of the time.
If these two pions are misidentified as muons then there is significant peaking background around
the \KS mass, because the mass of a muon and pion are similar.
To counter this, candidates are vetoed if the mass of $m_{\pi_\mu^+\pi_\mu^-}$ is within $25\mev$
of the known \KS mass.

Since the \db can be displaced from the \Bd decay vertex, a potential background for the decay
\dbtomumu is from a \mumu pair directly from a \pv.
This is suppressed by requiring that the transverse flight distance (\FDT) of the \db vertex, with
respect to the \pv is greater than $0.1\mm$.

Similar to in \Sec{sec:hhh:sel}, the decay \btokstrdb suffers from backgrounds from
\decay{\Bd}{\jpsi\Kstarz} where a hadron is misidentified as a hadron and vice versa.
In this case the background can be suppressed by requiring that neither the \Kp nor the \pim
satisfy the \ismuon criteria.
The effect of this cut is shown in \Fig{fig:db:doublemisid}.
A summary of all preselection cuts are shown in \Tab{tab:db:presel}.

\begin{figure}
  \begin{center}
    \includegraphics[width=0.48\textwidth]{blank}
    \caption{
      Double misid
    }
    \label{fig:db:doublemisid}
  \end{center}
\end{figure}

\begin{table}
  \caption[Preselection cuts] {
    Preselection cuts.
  }
  \label{tab:db:presel}
  \begin{center}
    \begin{tabularcuts}
      \Bd
      & $\theta_\mathrm{dir}$ &$<$& 0.03 & rad \\
      & $\chisqvtx$ &$<$& 15 \\
      & $\chisqip$ &$<$& 10 \\\littlerule
      \Kstarz
      %& $|m_{\kpi}-895.8|$ & $<$ & 100 & MeV \\
      & $|m_{\kpi}-m_{\Kstarz}^{\pdg}|$ & $<$ & 100 & MeV \\
      & $\dllkpi(K)-\dllkpi(\pi)$ & $>$ & 10 \\\littlerule
      \Kp
      & $\ismuon$ && {\tt False} \\
      & $\dllkpi$&  $>$ & -5 \\\littlerule
      \pip
      & $\ismuon$ && {\tt False} \\
      & $\dllkpi$&  $<$ & 25 \\\littlerule
      \db
      & $F\!D_T$ & $>$ & 0.1 & mm \\
      \bottomrule
    \end{tabularcuts}
  \end{center}
\end{table}


\subsection{Other backgrounds from misidentification}
\input{db/bkg}





\subsection{Multivariate selection}
Section \ref{sec:uboost} outlines the \uBDT algorithm, which trains a \BDT whereby events are
boosted based not only on misclassification, but also on how uniform the local response of the \BDT
is for a give set of variables.
In this case it is important that the \BDT does not bias the sample towards a given mass and
lifetime, which makes the \uBDT ideal for this analysis.
That being said, the uBoost algorithm should not be used at the expense of the performance of the
\BDT.
It is observed that the \uBDT algorithm in fact outperforms the AdaBoost algorithm in this case,
and therefore its use is justified.

A \uBDT is trained using a signal-proxy from simulated events and background taken from the upper
\Bd mass sideband where the \Bd candidate has a mass of over $150\mev$ above the nominal \Bd mass.
Specifically, the signal-proxy is a concoction of three different simulated samples in which the
\db has a mass of: 214, 1000, and $4000\mev$; and each has a lifetime of $100\ps$.
These samples are chosen to give the \uBDT algorithm input the largest range of masses possible.
The fact that each sample has the same lifetime is unimportant, because $\lifetime{adb}=100\ps$ is
sufficiently long for there to be a range of lifetimes in the signal-proxy sample.
Figure~\ref{fig:db:bdtflat} shows the effect of the uniform boosting, and that the efficiency for
all masses and lifetimes are approximately flat.

\begin{figure}
  \begin{center}
    \includegraphics[width=0.48\textwidth]{mvaMassEff}
    \includegraphics[width=0.48\textwidth]{anaTauEffMVA}
    \caption{
      It is observed that the efficiency of the \uBDT as a function of
      (left) \mdb and
      (right) \tdb is flat.
      Here, a cut which is \approx$85\pc$ efficient is applied.
    }
    \label{fig:bdt:eff:tau}
  \end{center}
\end{figure}

%\begin{equation}
  %P_\sigma = \frac{S}{\sqrt{B} + \frac\sigma2},
%\end{equation}
%where $\sigma$ is the desired level of observation, $S$ is the amount of signal, and $B$ is the
%bakground level.
%The value of $S$ is determined to be the number of signal events that pass a given cut, while $B$
%is calculated by

%to be the number of events rem
%using various simulated samples of the decay \btokstrdb, and is
%simpl
%
%a number of simulated samples of \btokstrdb, where the signal is
%simply the number of

The \uBDT cut is optimized  by maximizing
the Punzi figure-of-merit, which is defined as
\begin{equation}
  \mathcal{P}_\sigma = \frac{S}{\sqrt{B} + \tfrac12\sigma},
  \label{eq:db:punzi}
\end{equation}
where $S$ and $B$ are the signal and background yields, respectively; and $\sigma$ is the desired
level of observation.
The signal and background yields are calculated as follows:
$S$ is the number of simulated events which survive a \uBDT cut;
$B$ is the yield as estimated using \btokstrdb candidates
that fall outside $80\mev$ from the nominal \Bd mass~\cite{PDG2014} and within the region .
The invariant mass distributions of these candidates are fit to a decaying exponential,
and the background yield is taken to be the integral of this exponential within $60\mev$
(approximately $3\sigma$) of $m^\mathrm{PDG}(\Bd)$.

The figure-of-merit is considered separately for both the prompt and displaced candidates.
The optimal working point varies from sample to sample due to the fact that the background yield
depends on $(m,\tau)$.
However, the optimal point in the prompt case is approximately $uBDT>0.15$ for all samples, a
working point that
is approximately $85\pc$ efficient by constructing.
At this point in the displaced region, there is an estimated zero background.
This point was calculated used a value of $\sigma=5$, \Eq{eq:db:punzi}, although the result is seen
to be insensitive to its exact value.



\subsection{Normalization}
Limits on the branching fraction shall be calculated with respect to the decay \btokstrmumu,
restricted to the range $1.1<\qsq<6.0\gevgev$.
This range is chosen to minimise theoretical uncertainties at low and high \qsq and reduce
experimental uncertainties by removing the region around the \phii meson which has a central value
of mass in \qsq of \approx$1.04\gevgev$.



%In \Sect{sec:strategy} it is briefly mentioned that the observed signal yields will be normalized
%with respect to the SM decay \btokstrmumu.
%Specifically the \qsq range $1.1<\qsq<6.0\gevgev$ will be used, because theoretical and
%experimental uncertainties are low in this region.
%Here, \qsq is defined to be the invariant mass of the dimuon pair, squared.







%\subsection[Mass of \Bd candidates]{Mass of $\boldsymbol{\Bd}$ candidates}
%\label{ssec:sel:massb}
%As mentioned above, all masses in this analysis are computed using {\tt DecayTreeFitter}, where the
%mass of the \Bd candidate is constrained to the world average value in the vertex fit~\cite{PDG2012}.
%The analysis is performed on all \Bd candidates that fall within $150\mev$ of the nominal \Bd
%mass~\cite{PDG2012}, where the mass is the mass from the unconstrained vertex fit (the upper sideband of
%which is used for to train the multivariate selection, which is described below).
%A tighter criteria is placed on the \Bd mass to select the final sample of candidates to use in the \db search.
