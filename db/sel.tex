\section{Selection}
\label{sec:db:sel}

This analysis uses the full $3.0\invfb$ of data collected by the \lhcb
experiment~\cite{Alves:2008zz} in the years 2011 and 2012.
Since the properties of the \db are unknown, a variety of simulated samples of the decay \btokstrdb,
where \dbtomumu, were generated with a range of \mass{\db} and $\tau_\db$, a summary of these are
shown in \Table{tab:db:samples}.
Studies are also performed using simulated events of the decays \btokstrmumu and \btojpsikstr.

\begin{table}
  \caption[Samples of simulated \btokstrdb generated for the analysis]{
    Samples of simulated \btokstrdb generated with given mass and lifetime.
    A total of 1.5 million events are generated for each sample, but only 150 thousand for the
    samples with a \mass{\db} of 220 and $235\mev$.
  }
  \label{tab:db:samples}
  \begin{center}
    \begin{tabular}{rccccccccccc}\toprule
      $\tau_\db$ (ps) & \multicolumn{10}{c}{\mass{\db} (MeV)} \\\midrule
      10 &&&&&&&&&2500 \\
      100 &214&220&235&250&500&800&1000&1500&2000&2500&4000 \\
      1000 &&&&250&&&&&2500 \\
      \bottomrule
    \end{tabular}
  \end{center}
\end{table}

Reconstructed decays of \btokstrdb are required to have been selected by the \lone triggers for
muon, dimuon, or hadronic candidates.
Subsequent trigger levels require that the decay has a topology consistent with a $B$-meson
decaying in to a multi-body final state which includes muons.
Only \TOS candidates are used in this analysis for two reasons: firstly, the ratio of trigger
efficiency for the \sm \btokstrmumu to that of (possibly displaced) \db mode enters
into the limits and, thus, must be precisely determined; and the use of \TIS events would
come with a substantial enhancement of the di-$b$-hadron backgrounds.
The few percent gain in signal efficiency obtained using \TIS is not worth the increase in these
backgrounds di-$b$-hadron backgrounds.


Since the \db could be long lived, its decay vertex can lie downstream of the \Bd vertex, and could
fly far enough to leave acceptance of the \velo before it decays.
It is therefore wise to consider different \emph{track types}.
For most \lhcb analyses, the only appropriate tracks to use are \emph{long} tracks, which
have been used implicitly throughout this thesis.
Long tracks are fitted using hits in the tracking stations T1--3, the \velo, and can use \ttracker
information.
But, it is also possible to reconstruct tracks using only some of the tracking stations; for
example, a \emph{downstream} track is reconstructed using hits in the \ttracker and tracking
stations T1--3, but not the \velo.
Figure~\ref{fig:db:lldd} shows the various definitions of track types.
The problem with using downstream tracks is that they are not triggered efficiently in \hlttwo.
For example, a simulated \db with a mass of $250\mev$ and a lifetime of $100\ps$ has a
reconstruction and
stripping efficiency of \approx$0.9\pc$ if the muons are both long tracks, but the equivalent
number for downstream tracks is \approx$2.5\pc$; due to the boost of a light object from a decaying
\Bd.
However, the trigger efficiency for this sample is \approx$45\pc$ and $8\pc$ for long and
downstream candidates respectively.
There is therefore a factor two more long-track candidates for the $250\mev$ $100\ps$ sample; which
is a factor of a few hundred for more massive, or shorter lifetime, dark bosons.
For this reason, this analysis deals only with \db candidates formed from long-track muons.

\begin{figure}
  \begin{center}
    \includegraphics[scale=0.7]{track}
    \caption[Track definitions in the LHCb detector]
    {
      Schematic diagram of the \lhcb tracking system, showing the \velo, \ttracker, and tracking
      stations T1--3.
      Track types at \lhcb are defined by the regions through which they travel, as labelled in the
      diagram.
      Most tracks used in analyses are classified as long tracks, but for long-lived particles
      (such as the \KS) downstream tracks are often also used to increase statistics.
      This analysis focused on long tracks.
    }
    \label{fig:db:lldd}
  \end{center}
\end{figure}

%The selection
%Simulated samples are extremely important for this analysis,
%It is important to remove sources of background while leaving the invariant mass of the dimuon
%distribution smoothly varying, so that the assumption of local-linearity remains.
%In \Sec{sec:strategy} resonances are discussed, and those where $\Gamma<5\sigmam$ must be vetoed.
%For this analysis,


The offline selection criteria applied in the stripping are outlined in \Tab{tab:stripping}.
This table lists the variables \ProbNN{\pi} and \ProbNN{K} which are \MVA algorithms
giving a response between zero and one, quantifying how pion or kaon like a particle is, respectively.
The full decay chain \btokstrdb and \dbtomumu is reconstructed using a fit in which the \Bd mass is
constrained to its known value~\cite{PDG2014}.
All references to $m(\db)$, $m(\Kstar)$ or $\tau(\db)$ are to the values after this vertex fit
has been performed.

\begin{table}[ht!]
  \caption[Stripping selection]
  {
    Selection criteria applied to signal candidates.
    Criteria definitions are defined in text.
    While the \Bd mass is constrained in the fit, the selection makes a cut on the unconstrained
    mass.
    %The variable {\tt DOCA} is defined as the distance of closest approach between any two pairs of
    %tracks in the candidate.
  }
  \label{tab:stripping}
  \begin{center}
    \begin{tabularcuts}
      \Bp
      & $\chisqvtx/\ndf$          & $<$ & 25   \\
      & \chisqip                  & $<$ & 50   \\ % BPVIPCHI2
      & $\tau$                    & $>$ & 0.2 & ps  \\
      & $m$                       & $\in$ & $[4800, 5800]$  & MeV \\
      & \pt                       & $>$ & 1000    & MeV   \\
      & $\cos\theta_\mathrm{dir}$     & $>$ & 0 \\
      \littlerule
      \db
      & $\chisqvtx/\ndf$          & $<$ & 10   \\ % VCHI2DOF
      & $\chisqfd$                & $<$ & 25   \\
      & \pt                       & $>$ & 250  & MeV \\
      & DOCA                & $<$ & 0.2 & mm \\
      & DOCA \chisq         & $<$ & 25  &    \\
      \littlerule
      Tracks
      & $\chisqtrk/\ndf$          & $<$ & 3    \\
      & $\min(\chisqip)$                  & $>$ & 9    \\ % MIPCHI2DV
      & \ProbNN{\mathrm{gh}} & $<$ & 0.3  \\
      \littlerule
      $\Kp$, $\pip$
      & \pt                       & $>$ & 250  & MeV \\
      & $p$                       & $>$ & 2000 & MeV \\
      & \chisqip                  & $>$ & 9 \\
      \Kp
      & \ProbNN{K}             & $>$ & 0.1  \\
      \pip
      & \ProbNN{\pi}           & $>$ & 0.2  \\
      \mup
      & \pt                       & $>$ & 100  & MeV \\
      & {\tt PIDmu}               & $>$ & -5   \\
      & \ismuon                   & & True \\
      \bottomrule
    \end{tabularcuts}
  \end{center}
\end{table}


\subsection{Preselection}
After the stripping and triggering stages, a loose preselection is applied, cutting on both
topological and \pid quantities; all these cuts are summarized in \Tab{tab:db:presel}.
The topological selection requirements are approximately $90\pc$ signal efficient on all simulated
samples.

Selection requirements are applied to the \Kstar and its daughters to remove candidates that are
inconsistent with the decay  \decay{\Kstarz}{\kpi}.
Firstly, the \kpi invariant mass must
within $100\mev$ of the known $K^*(892)^0$ mass, which has been measured to be
$(895.81\pm0.19)\mev$~\cite{PDG2014}.
\pid constraints are also applied to each \Kstar daughter: $\dllkpi(\Kp)>-5$, $\dllkpi(\pip)<25$;
and to ensure that the kaon candidate is more consistent with a kaon than the pion candidate a cut on the
difference in \glspl{DLL} is also applied: $\dllkpi(\Kp)-\dllkpi(\pip)>10$.

The decay \decay{\KS}{\pipi} has a branching fraction of
$(69.20\pm0.05)\e{-2}$~\cite{PDG2014}, and is removed in the preselection by requiring that
$|m_{\pi_\mu^+\pi_\mu^-}-m_{\KS}^\mathrm{PDG}|<25\mev$.
This roughly translates to a cut in the dimuon invariant mass spectrum of
$436<m_{\mumu}<490\mev$.

Since the \db can be displaced from the \Bd decay vertex, a potential background for the decay
\dbtomumu is from a \mumu pair directly from a \pv.
This is suppressed by requiring that the transverse flight distance (\FDT) of the \db vertex, with
respect to the \pv is greater than $0.1\mm$.

The high branching fraction of \decay{\Bd}{\jpsi(\to\mumu)\Kstarz} means that there is also
contamination from decays where a hadron is misidentified as a muon, and vice versa.
This background can be suppressed by requiring that neither of the \Kstarz daughters satisfy the
\ismuon criteria, the effect of this cut is shown in \Fig{fig:db:doublemisid}, which shows the
invariant mass of the hadron-muon pair before and after the requirement that the hadrons fail the
\ismuon criterion.
A summary of all preselection cuts is shown in \Tab{tab:db:presel}.

\begin{figure}
  \begin{center}
    \includegraphics[width=0.48\textwidth]{double_misid_pi}
    \includegraphics[width=0.48\textwidth]{double_misid_k}
    \caption[Effect of the double misidentification veto]
    {
      Background contributions from \decay{\Bd}{\jpsi\Kstarz}, where both a muon and
      (left) pion and (right) kaon are misidentified as one another.
      This background is very effectively removed by requiring that the hadron does not
      satisfy the {\tt isMuon} criteria; the effect of this veto is shown with a dotted line.
    }
    \label{fig:db:doublemisid}
  \end{center}
\end{figure}


\begin{table}
  \caption[Preselection cuts]
  {
    Preselection criteria applied to \btokstrdb candidates.
  }
  \label{tab:db:presel}
  \begin{center}
    \begin{tabularcuts}
      \Bd
      & $\theta_\mathrm{dir}$ &$<$& 0.03 & rad \\
      & $\chisqvtx$ &$<$& 15 \\
      & $\chisqip$ &$<$& 10 \\\littlerule
      \Kstarz
      %& $|m_{\kpi}-895.8|$ & $<$ & 100 & MeV \\
      & $|m_{\kpi}-m_{\Kstarz}^{\pdg}|$ & $<$ & 100 & MeV \\
      & $\dllkpi(K)-\dllkpi(\pi)$ & $>$ & 10 \\\littlerule
      \Kp
      & $\ismuon$ && {\tt False} \\
      & $\dllkpi$&  $>$ & -5 \\\littlerule
      \pip
      & $\ismuon$ && {\tt False} \\
      & $\dllkpi$&  $<$ & 25 \\\littlerule
      \db
      & $F\!D_T$ & $>$ & 0.1 & mm \\
      & $m$  & $\notin$ & $[436,490]$ & MeV \\
      \bottomrule
    \end{tabularcuts}
  \end{center}
\end{table}


\input{db/bkg}


\subsection{Combinatorial background and multivariate selection}
%\bam{CLARIFY}
The data sample is purified from combinatorial background using a multivariate selection technique.
Section~\ref{sec:bdt:uboost} outlines the \uBDT algorithm, which trains a \BDT whereby events are
boosted not only based on misclassification, but also on how uniform the local response of the \BDT
is for a given set of variables.
For the case of this analysis, it is important that the \BDT does not bias the sample towards a
given mass and
lifetime, which makes the \uBDT ideal for this analysis.
That being said, the uBoost algorithm should not be used at the expense of the performance of the
\BDT.
The \uBDT algorithm is seen to outperform the AdaBoost algorithm in this case,
and therefore its use is justified.

A \uBDT is trained using a signal-proxy from simulated events and background taken from the upper
\Bd mass sideband where the \Bd candidate has a mass of over $150\mev$ above the nominal \Bd mass.
Specifically, the signal-proxy is a concoction of three different simulated samples in which the
\db has a mass of: 214, 1000, and $4000\mev$; and each has a lifetime of $100\ps$.
These samples are chosen to give the \uBDT algorithm input the largest range of masses possible;
particularly a $\mdb=214\mev$ sample was chosen because it is close to threshold and equal to the
mass of the $P^0$ evidenced in the Hyper-\CP experiment~\cite{Park:2005eka}.
%The fact that each sample has the same lifetime is unimportant, because $\lifetime{\db}=100\ps$ is
%sufficiently long for there to be a range of lifetimes in the signal-proxy sample.
%Figure~\ref{fig:db:bdtflat} shows the effect of the uniform boosting, and that the efficiency for
%all masses and lifetimes are approximately flat.
It is observed that the response of a \uBDT cut does result in a uniform signal efficiency in both
the mass and lifetime distributions; this is shown in \Fig{fig:db:bdtflat}.

\begin{figure}
  \begin{center}
    \includegraphics[width=0.48\textwidth]{mvaMassEff}
    \includegraphics[width=0.48\textwidth]{anaTauEffMVA}
    \caption[Signal efficiency of a uBDT cut as a function of mass and lifetime]
    {
      Signal efficiencies from simulation for a \uBDT cut which is approximately $85\pc$ efficient,
      the distributions are are approximately flat in both the (left) mass and (right) lifetime
      dimensions.
    }
    \label{fig:db:bdtflat}
  \end{center}
\end{figure}

%\begin{equation}
  %P_\sigma = \frac{S}{\sqrt{B} + \frac\sigma2},
%\end{equation}
%where $\sigma$ is the desired level of observation, $S$ is the amount of signal, and $B$ is the
%bakground level.
%The value of $S$ is determined to be the number of signal events that pass a given cut, while $B$
%is calculated by

%to be the number of events rem
%using various simulated samples of the decay \btokstrdb, and is
%simpl
%
%a number of simulated samples of \btokstrdb, where the signal is
%simply the number of

The \uBDT cut is optimized  by maximizing
the Punzi figure-of-merit~\cite{2003sppp.conf...79P}, which is defined as
\begin{equation}
  \mathrm{Punzi}_{\sigma_\mathrm{p}} = \frac{S}{\sqrt{B} + \tfrac12\sigma_\mathrm{p}},
  \label{eq:db:punzi}
\end{equation}
where $S$ and $B$ are the signal and background yields, respectively; and $\sigma_\mathrm{p}$ is the desired
level of observation.
The signal and background yields are calculated as follows:
$S$ is the number of simulated signal events which survive a \uBDT cut;
$B$ is the background yield as estimated using \btokstrdb candidates
that fall outside $80\mev$ from the nominal \Bd mass~\cite{PDG2014}.
The invariant mass distributions of these candidates in data are fit to a decaying exponential,
and the background yield is taken to be the integral of this exponential within $60\mev$
(approximately $3\sigma$) of the known \Bd mass.

The figure-of-merit is considered separately for both the prompt and displaced candidates.
The optimal working point varies from sample to sample due to the fact that the background yield
depends on $(m,\tau)$.
However, the optimal point in the prompt case is approximately $\mathrm{uBDT}>0.15$ for all samples, a
working point that
is approximately $85\pc$ efficient by constructing.
At this point in the displaced region, there is an estimated zero background.
This point was calculated using a value of $\sigma_\mathrm{p}=5$, \Eq{eq:db:punzi}, although the
result is seen to be insensitive to its exact value.

While the \uBDT does suppress the combinatorial background, some will still remain.
The contribution of combinatorial background must be assessed to ensure that it is not a problem.
Using \Bd candidates that fall above the \Bd mass peak where the contribution is purely
combinatorial background, an idea of the distribution of \db candidates from random combinations of
particles can be assessed.
An analysis reveals that there is an average of \approx$2$ and \approx$0.2$ events in a signal
window (defined using $\pm2\sigmam$) in the prompt and displaced regions, respectively.


%This is done using the following
%procedure for each of the lifetime regions:
%\begin{itemize}
  %\item Perform fit using an exponential function to the upper and lower mass sidebands of the \Bd
    %candidate mass spectrum.  Sideband regions are defined by the areas outside of $60\mev$ from
    %the known \Bd mass (approximately $3\,\sigma$).
    %The fits are shown in \Fig{fig:res:comb}.
  %\item Calculate the integral of the background function (exponential) in the signal region
    %(within $60\mev$ of the known \Bd mass).
    %Let the value of the integral be $m$.
  %\item Take $m$ events from the upper sideband, and plot the mass of each dimuon candidate that
    %forms the \Bd candidates.
%\end{itemize}
%The resulting invariant dimuon mass spectrum is shown in \Fig{fig:res:comb}; in the prompt case
%there is an average of 1.8 events in each bin, in the displaced region the number is nearer 0.2.
%Using bin widths comparable to the signal window size ($20\mev$) it is seen that the estimated
%number of events per bin is always five or less, with an average of less than one event per bin.
%A more detailed study will be performed below in wide bins as part of the unblinding strategy.


%\begin{figure}
  %\begin{center}
    %\includegraphics[width=0.48\textwidth]{combinatorial_prompt_fit}
    %\includegraphics[width=0.48\textwidth]{combinatorial_displaced_fit}\\
    %\includegraphics[width=0.48\textwidth]{combinatorial_prompt}
    %\includegraphics[width=0.48\textwidth]{combinatorial_displaced}
    %\caption{
      %Fits to the prompt and displaced regions are shown in
      %(upper left) and
      %(upper right) respectively; where the dark blue box indicates the signal
      %region, and the lighter blue indicates the upper sideband which has the same area as the
      %background contribution to the signal region.
      %Combinatorial background estimations from data, as described in text are shown in
      %(lower left) the prompt region, and
      %(lower right) the displaced region.
      %Each bin is $20\mev$ wide, which is comparable to the width of the signal region.
    %}
    %\label{fig:res:comb}
  %\end{center}
%\end{figure}







%In \Sect{sec:strategy} it is briefly mentioned that the observed signal yields will be normalized
%with respect to the SM decay \btokstrmumu.
%Specifically the \qsq range $1.1<\qsq<6.0\gevgev$ will be used, because theoretical and
%experimental uncertainties are low in this region.
%Here, \qsq is defined to be the invariant mass of the dimuon pair, squared.


%\subsection[Mass of \Bd candidates]{Mass of $\boldsymbol{\Bd}$ candidates}
%\label{ssec:sel:massb}
%As mentioned above, all masses in this analysis are computed using {\tt DecayTreeFitter}, where the
%mass of the \Bd candidate is constrained to the world average value in the vertex fit~\cite{PDG2012}.
%The analysis is performed on all \Bd candidates that fall within $150\mev$ of the nominal \Bd
%mass~\cite{PDG2012}, where the mass is the mass from the unconstrained vertex fit (the upper sideband of
%which is used for to train the multivariate selection, which is described below).
%A tighter criteria is placed on the \Bd mass to select the final sample of candidates to use in the \db search.
