\section{Selection}

Signal candidates for the decays \btokpipimumu and \btophikmumu must first pass the \lone trigger
line {\tt L0Muon}.
Subsequent software trigger stages required that at least one final-state muon has $\pt>1.6\gev$
and at least one hadron has $\pt>1.0\gev$, both of which had an IP larger than $100\mum$ with
respect to any PV in the event.
The response of the topological BBDT in the \hlttwo must be consistent with a decaying $B$ meson
with muons in the final state.

%There is large overlap between the...

Candidate \Bp hadrons are then formed from combinations of three hadrons and a pair of opposite
sign nuons.
Fully reconstructed candidates must form a good quality vertex, with a \chisq of the vertex fit
$<6$.
This secondary vertex must be well displaced from any PV, having a flight distance inconsistent
with zero; ($\chisqfd>121$).
The angle between the \Bp candidate momentum vector and the direction defined by the PV to \Bp decay
vertex must be less than $14\mrad$.
Each track must satisfy $\chisqip>16$, where the \chisqip of a track is defined as the change in
\chisqip when calculated with and without the track in question.
The muons must both satisfy the {\tt isMuon} criteria and have $\dllmupi>0$.
Hadrons have PID criteria applied later, after optimization, but the total invariant mass of the
\kpipi system is required to be below $2400\mev$.
Each hadron must have $\pt>500\gev$.
For the \phik system, the additional constraint that the \decay{\phi}{\kk} object must have an
invariant mass within $12\mev$ of $m_\phi^\pdg$.



\subsection{Irreducible backgrounds}

Processes with the same final state as \btokpipimumu and \btophikmumu are not smoothly distributed
in $m_{K\pi\pi\mu\mu}$, rather they peak under the signal.
The tree level decays \decay{\Bp}{\jpsi\kpipi} and \decay{\Bp}{\jpsi\phik}, where
\decay{\jpsi}{\mumu}, have large branching fractions:
\begin{align}
  \BF(\decay{\Bp}{\jpsi(\to\mumu)\kpipi}) &= (4.8 \pm 0.8)\e{-5} \\
  \BF(\decay{\Bp}{\jpsi(\to\mumu)\phik}) &= (3.1 \pm 1.1)\e{-6},
\end{align}
and the same final state particles.
The same is true for the large contributions from \decay{\Bp}{\psitwos\kpipi} and
\decay{\Bp}{\psitwos\phik} decays, where \decay{\psitwos}{\mumu}.
These contributions from charmonium decays constitute large, irreducible backgrounds and must be
removed with vetoes around the \jpsi and \psitwos masses.
The vetoes used remove events where the invariant dimuon mass falls in either region
$2946<m_{\mu\mu}<3176\mev$ or $3586<m_{\mu\mu}<3766\mev$.

Mis-reconstructed decays to charmonium contribute to the upper mass sideband.
To remove these, the veto windows are extended up by $40\mev$ in the region
$5330<m_{B^+_\mathrm{candidate}}<5450\mev$.
Radiative tails from the decays \decay{\jpsi}{\mumu\gamma} and \decay{\psitwos}{\mumu\gamma} are
suppressed by extending the vetoes down by $250\mev$ and $100\mev$ respectively in the region
$m_{B^+_\mathrm{candidate}}<5230\mev$.
Figure~{fig:hhh:charmvetoes} shows the boundaries defined by these vetoes on data.

%However, the amount of contamination from decaying \jpsi and \psitwos is so great that both show
%evidence of asymmetric tails from

\begin{figure}
  \begin{center}
    \includegraphics[width=0.45\textwidth]{BvJpre}
    %\includegraphics[width=0.45\textwidth]{BvJpost}\\
    \includegraphics[width=0.45\textwidth]{BvJkkkpre}
    %\includegraphics[width=0.45\textwidth]{BvJkkkpost}
    \caption{\small
      Charmonium vetoes.
    }
    \label{fig:hhh:charmvetoes}
  \end{center}
\end{figure}

Given the large branching fractions of the charmonium decays given above, and the probability of
misidentifying a muon as a pion or kaon is $\mathcal{O}(1\,\%)$,~\cite{LHCb-DP-2013-001}
there could have been significant contamination from mis-identified candidates.
This potential background was removed by calculating the invariant mass of each $\mu^+\pi^-$ and
$\mu^+K^-$ combination, where the hadron was assigned the muon mass.
If the mass of this object fell within $50\mev$ of $m_\jpsi$ or $m_\psitwos$, then the candidate
was vetoed.

%To remove these, each hadron was assigned the muon mass, and each possible opposite sign com
%combination of



%PID info from the RICH is used to identify final state hadrons
%PV chosen based on lowest PV of B candidateo
%vertex fit \chisq must increase by more than 121 when including the B candidate daughters
%fit vertex chi2 < 6

%Backgorunds of \jpsi and \psitwos must be removed
%also their radiative tails

%main sources of peaking backgrounds come from charmonia

\subsection{Multivariate selection}
Combinatorial background was suppressed using a BDT trained using the AdaBoost
algorithm~\cite{AdaBoost}; for more details please refer to \Sect{sec:bdt:ada}.









\subsection{Reweighting of variables}



%\section{Backgrounds}
%\section{Mass fits}
%\section{Efficiencies}
%\section{Systematics}
%\section{Summary}
